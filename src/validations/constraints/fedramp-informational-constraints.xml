<?xml version="1.0" encoding="UTF-8"?>
<metaschema-meta-constraints xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
    <context>
        <metapath target="/system-security-plan"/>

            <constraints>
                    <let var="all-imports" expression="recurse-depth('resolve-profile(doc(resolve-uri(import-profile/@href)))//catalog')"/>
                    <!-- Collect all the control IDs from imported profiles -->
                    <let var="all-control-ids" expression="map:merge($all-imports//control ! map:entry(@id,.))?*"/>
                    
                    <!-- Collect all the implemented requirements' control IDs -->
                    <let var="implemented-ids" expression="map:merge(//implemented-requirement ! map:entry(@control-id,.))?*"/>
                    <!-- Extraneous Implemented Requirements -->
    
                    <expect id="total-imported-controls" target="control-implementation"
                            test="not(count($all-control-ids) gt 0)" level="INFORMATIONAL">
                        <message>This SSP Has {(count($all-control-ids)) } Imported Controls and {count($implemented-ids)} implimented requirements</message>
                    </expect>
        </constraints>
    </context>
</metaschema-meta-constraints>
